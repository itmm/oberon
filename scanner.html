<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<title>Scanner for Oberon Compiler</title>
<link rel="stylesheet" type="text/css" href="slides/slides.css"></head>
<body>
<h1>Scanner for Oberon Compiler</h1>
<div class="slides">
<div>
<div>
<h1>Scanner for Oberon Compiler</h1>
</div>
</div>
<div><div>
<code>
<span class="macro">@Def(<span class="name">file: scanner.h</span>)</span><br/>
<span class="in1"></span><span class="keyword">#pragma</span> <span class="keyword">once</span><br/>
<span class="in1"></span><span class="macro">@put(<span class="name">includes</span>)</span>;<br/>
<span class="in1"></span><span class="macro">@put(<span class="name">globals</span>)</span>;<br/>
<span class="in1"></span><span class="keyword">class</span> <span class="type">Scanner</span> {<br/>
<span class="in2"></span><span class="keyword">private</span>:<br/>
<span class="in3"></span><span class="macro">@put(<span class="name">privates</span>)</span>;<br/>
<span class="in2"></span><span class="keyword">public</span>:<br/>
<span class="in3"></span><span class="macro">@put(<span class="name">publics</span>)</span>;<br/>
<span class="in1"></span>};<br/>
<span class="in1"></span><span class="keyword">#if</span> <span class="var">scanner_IMPL</span><br/>
<span class="in2"></span><span class="macro">@put(<span class="name">impl</span>)</span>;<br/>
<span class="in1"></span><span class="keyword">#endif</span><br/>
<span class="macro">@End(<span class="name">file: scanner.h</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@Def(<span class="name">file: scanner.cpp</span>)</span><br/>
<span class="in1"></span><span class="keyword">#define</span> <span class="var">scanner_IMPL</span> <span class="num">1</span><br/>
<span class="in1"></span><span class="keyword">#include</span> <span class="str">"scanner.h"</span><br/>
<span class="macro">@End(<span class="name">file: scanner.cpp</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="type">enum</span> <span class="keyword">class</span> <span class="type">Symbol</span> {<br/>
<span class="in2"></span><span class="var">s_null</span> = <span class="num">0</span>,<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">symbols</span>)</span><br/>
<span class="in2"></span><span class="var">s_eot</span> = <span class="num">70</span><br/>
<span class="in1"></span>};<br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">symbols</span>)</span><br/>
<span class="in1"></span><span class="var">s_times</span> = <span class="num">1</span>, <span class="var">s_rdiv</span> = <span class="num">2</span>, <span class="var">s_div</span> = <span class="num">3</span>, <span class="var">s_mod</span> = <span class="num">4</span>, <span class="var">s_and</span> = <span class="num">5</span>,<br/>
<span class="in1"></span><span class="var">s_plus</span> = <span class="num">6</span>, <span class="var">s_minus</span> = <span class="num">7</span>, <span class="var">s_or</span> = <span class="num">8</span>, <span class="var">s_eql</span> = <span class="num">9</span>, <span class="var">s_neq</span> = <span class="num">10</span>,<br/>
<span class="in1"></span><span class="var">s_lss</span> = <span class="num">11</span>, <span class="var">s_leq</span> = <span class="num">12</span>, <span class="var">s_gtr</span> = <span class="num">13</span>, <span class="var">s_geq</span> = <span class="num">14</span>, <span class="var">s_in</span> = <span class="num">15</span>,<br/>
<span class="in1"></span><span class="var">s_is</span> = <span class="num">16</span>, <span class="var">s_arrow</span> = <span class="num">17</span>, <span class="var">s_period</span> = <span class="num">18</span>, <span class="var">s_char</span> = <span class="num">20</span>,<br/>
<span class="in1"></span><span class="var">s_int</span> = <span class="num">21</span>, <span class="var">s_real</span> = <span class="num">22</span>, <span class="var">s_false</span> = <span class="num">23</span>, <span class="var">s_true</span> = <span class="num">24</span>, <span class="var">s_nil</span> = <span class="num">25</span>,<br/>
<span class="in1"></span><span class="var">s_string</span> = <span class="num">26</span>, <span class="var">s_not</span> = <span class="num">27</span>, <span class="var">s_lparen</span> = <span class="num">28</span>, <span class="var">s_lbrak</span> = <span class="num">29</span>,<br/>
<span class="in1"></span><span class="var">s_lbrace</span> = <span class="num">30</span>, <span class="var">s_ident</span> = <span class="num">31</span>, <span class="var">s_if</span> = <span class="num">32</span>, <span class="var">s_while</span> = <span class="num">34</span>,<br/>
<span class="in1"></span><span class="var">s_repeat</span> = <span class="num">35</span>, <span class="var">s_case</span> = <span class="num">36</span>, <span class="var">s_for</span> = <span class="num">37</span>, <span class="var">s_comma</span> = <span class="num">40</span>,<br/>
<span class="in1"></span><span class="var">s_colon</span> = <span class="num">41</span>, <span class="var">s_becomes</span> = <span class="num">42</span>, <span class="var">s_upto</span> = <span class="num">43</span>, <span class="var">s_rparen</span> = <span class="num">44</span>,<br/>
<span class="in1"></span><span class="var">s_rbrak</span> = <span class="num">45</span>, <span class="var">s_rbrace</span> = <span class="num">46</span>, <span class="var">s_then</span> = <span class="num">47</span>, <span class="var">s_of</span> = <span class="num">48</span>, <span class="var">s_do</span> = <span class="num">49</span>,<br/>
<span class="in1"></span><span class="var">s_to</span> = <span class="num">50</span>, <span class="var">s_by</span> = <span class="num">51</span>, <span class="var">s_semicolon</span> = <span class="num">52</span>, <span class="var">s_end</span> = <span class="num">53</span>, <span class="var">s_bar</span> = <span class="num">54</span>,<br/>
<span class="in1"></span><span class="var">s_else</span> = <span class="num">55</span>, <span class="var">s_elsif</span> = <span class="num">56</span>, <span class="var">s_until</span> = <span class="num">57</span>, <span class="var">s_return</span> = <span class="num">58</span>,<br/>
<span class="in1"></span><span class="var">s_array</span> = <span class="num">60</span>, <span class="var">s_record</span> = <span class="num">61</span>, <span class="var">s_pointer</span> = <span class="num">62</span>, <span class="var">s_const</span> = <span class="num">63</span>,<br/>
<span class="in1"></span><span class="var">s_type</span> = <span class="num">64</span>, <span class="var">s_var</span> = <span class="num">65</span>, <span class="var">s_procedure</span> = <span class="num">66</span>, <span class="var">s_begin</span> = <span class="num">67</span>,<br/>
<span class="in1"></span><span class="var">s_import</span> = <span class="num">68</span>, <span class="var">s_module</span> = <span class="num">69</span>,<br/>
<span class="macro">@end(<span class="name">symbols</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">includes</span>)</span><br/>
<span class="in1"></span><span class="keyword">#include</span> &lt;<span class="type">map</span>&gt;<br/>
<span class="in1"></span><span class="keyword">#include</span> &lt;<span class="type">string</span>&gt;<br/>
<span class="macro">@end(<span class="name">includes</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">globals</span>)</span><br/>
<span class="in1"></span><span class="keyword">#if</span> <span class="var">scanner_IMPL</span><br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">map</span>&lt;<span class="type">std</span>::<span class="type">string</span>, <span class="type">Symbol</span>&gt; <span class="var">keywords</span>;<br/>
<span class="in2"></span><span class="type">struct</span> <span class="type">Keyword_Init</span> {<br/>
<span class="in3"></span><span class="fn">Keyword_Init</span>() {<br/>
<span class="in4"></span><span class="macro">@put(<span class="name">keyword init</span>)</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in2"></span>} <span class="var">keyword_init</span>;<br/>
<span class="in1"></span><span class="keyword">#else</span><br/>
<span class="in2"></span><span class="type">extern</span> <span class="type">std</span>::<span class="type">map</span>&lt;<span class="type">std</span>::<span class="type">string</span>, <span class="type">Symbol</span>&gt; <span class="var">keywords</span>;<br/>
<span class="in1"></span><span class="keyword">#endif</span><br/>
<span class="macro">@end(<span class="name">globals</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">keyword init</span>)</span><br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"IF"</span>] = <span class="type">Symbol</span>::<span class="var">s_if</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"DO"</span>] = <span class="type">Symbol</span>::<span class="var">s_do</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"OF"</span>] = <span class="type">Symbol</span>::<span class="var">s_of</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"OR"</span>] = <span class="type">Symbol</span>::<span class="var">s_or</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"TO"</span>] = <span class="type">Symbol</span>::<span class="var">s_to</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"IN"</span>] = <span class="type">Symbol</span>::<span class="var">s_in</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"IS"</span>] = <span class="type">Symbol</span>::<span class="var">s_is</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"BY"</span>] = <span class="type">Symbol</span>::<span class="var">s_by</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"END"</span>] = <span class="type">Symbol</span>::<span class="var">s_end</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"NIL"</span>] = <span class="type">Symbol</span>::<span class="var">s_nil</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"VAR"</span>] = <span class="type">Symbol</span>::<span class="var">s_var</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"DIV"</span>] = <span class="type">Symbol</span>::<span class="var">s_div</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"MOD"</span>] = <span class="type">Symbol</span>::<span class="var">s_mod</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"FOR"</span>] = <span class="type">Symbol</span>::<span class="var">s_for</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"ELSE"</span>] = <span class="type">Symbol</span>::<span class="var">s_else</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"THEN"</span>] = <span class="type">Symbol</span>::<span class="var">s_then</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"TRUE"</span>] = <span class="type">Symbol</span>::<span class="var">s_true</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"TYPE"</span>] = <span class="type">Symbol</span>::<span class="var">s_type</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"CASE"</span>] = <span class="type">Symbol</span>::<span class="var">s_case</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"ELSIF"</span>] = <span class="type">Symbol</span>::<span class="var">s_elsif</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"FALSE"</span>] = <span class="type">Symbol</span>::<span class="var">s_false</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"ARRAY"</span>] = <span class="type">Symbol</span>::<span class="var">s_array</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"BEGIN"</span>] = <span class="type">Symbol</span>::<span class="var">s_begin</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"CONST"</span>] = <span class="type">Symbol</span>::<span class="var">s_const</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"UNTIL"</span>] = <span class="type">Symbol</span>::<span class="var">s_until</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"WHILE"</span>] = <span class="type">Symbol</span>::<span class="var">s_while</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"RECORD"</span>] = <span class="type">Symbol</span>::<span class="var">s_record</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"REPEAT"</span>] = <span class="type">Symbol</span>::<span class="var">s_repeat</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"RETURN"</span>] = <span class="type">Symbol</span>::<span class="var">s_return</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"IMPORT"</span>] = <span class="type">Symbol</span>::<span class="var">s_import</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"MODULE"</span>] = <span class="type">Symbol</span>::<span class="var">s_module</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"POINTER"</span>] = <span class="type">Symbol</span>::<span class="var">s_pointer</span>;<br/>
<span class="in1"></span><span class="var">keywords</span>[<span class="str">"PROCEDURE"</span>] = <span class="type">Symbol</span>::<span class="var">s_procedure</span>;<br/>
<span class="macro">@end(<span class="name">keyword init</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">includes</span>)</span><br/>
<span class="in1"></span><span class="keyword">#include</span> &lt;<span class="var">iostream</span>&gt;<br/>
<span class="macro">@end(<span class="name">includes</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">privates</span>)</span><br/>
<span class="in1"></span><span class="type">std</span>::<span class="type">istream</span> &amp;<span class="var">_in</span> = <span class="type">std</span>::<span class="var">cin</span>;<br/>
<span class="in1"></span><span class="type">int</span> <span class="var">_ch</span>;<br/>
<span class="macro">@end(<span class="name">privates</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">publics</span>)</span><br/>
<span class="in1"></span><span class="fn">Scanner</span>(<span class="type">std</span>::<span class="type">istream</span> &amp;<span class="keyword">in</span> = <span class="type">std</span>::<span class="var">cin</span>):<br/>
<span class="in2"></span><span class="var">_in</span> { <span class="keyword">in</span> }, <span class="var">_ch</span>{<span class="str">' '</span>}<br/>
<span class="in1"></span>{ }<br/>
<span class="macro">@end(<span class="name">publics</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">privates</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">next_ch</span>() {<br/>
<span class="in2"></span><span class="var">_ch</span> = <span class="var">_in</span>.<span class="fn">get</span>();<br/>
<span class="in2"></span>// <span class="type">std</span>::<span class="var">cout</span> &lt;&lt; (<span class="type">char</span>) <span class="var">_ch</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">privates</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">publics</span>)</span><br/>
<span class="in1"></span><span class="type">Symbol</span> <span class="fn">next</span>();<br/>
<span class="macro">@end(<span class="name">publics</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">privates</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">comment</span>();<br/>
<span class="macro">@end(<span class="name">privates</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">privates</span>)</span><br/>
<span class="in1"></span><span class="type">Symbol</span> <span class="fn">number</span>();<br/>
<span class="macro">@end(<span class="name">privates</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">impl</span>)</span><br/>
<span class="in1"></span><span class="type">Symbol</span> <span class="type">Scanner</span>::<span class="fn">next</span>() {<br/>
<span class="in2"></span><span class="type">Symbol</span> <span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_null</span>;<br/>
<span class="in2"></span><span class="keyword">while</span> (<span class="var">s</span> == <span class="type">Symbol</span>::<span class="var">s_null</span>) {<br/>
<span class="in3"></span><span class="keyword">while</span> (<span class="var">_ch</span> != <span class="num">EOF</span> &amp;&amp; <span class="var">_ch</span> &lt;= <span class="str">' '</span>) {<br/>
<span class="in4"></span><span class="fn">next_ch</span>();<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">_ch</span> == <span class="num">EOF</span>) {<br/>
<span class="in4"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_eot</span>;<br/>
<span class="in3"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> &lt; <span class="str">'A'</span>) {<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">_ch</span> &lt; <span class="str">'0'</span>) {<br/>
<span class="in5"></span><span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'"'</span>) {<br/>
<span class="in6"></span><span class="fn">string</span>();<br/>
<span class="in6"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_string</span>;<br/>
<span class="in5"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'#'</span>) {<br/>
<span class="in6"></span><span class="fn">next_ch</span>();<br/>
<span class="in6"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_neq</span>;<br/>
<span class="in5"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'$'</span>) {<br/>
<span class="in6"></span><span class="fn">hex_string</span>();<br/>
<span class="in6"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_string</span>;<br/>
<span class="in5"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'&amp;'</span>) {<br/>
<span class="in6"></span><span class="fn">next_ch</span>();<br/>
<span class="in6"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_and</span>;<br/>
<span class="in5"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'('</span>) {<br/>
<span class="in6"></span><span class="fn">next_ch</span>();<br/>
<span class="in6"></span><span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'*'</span>) {<br/>
<span class="in7"></span><span class="fn">comment</span>();<br/>
<span class="in6"></span>} <span class="keyword">else</span> {<br/>
<span class="in7"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_lparen</span>;<br/>
<span class="in6"></span>}<br/>
<span class="in5"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">')'</span>) {<br/>
<span class="in6"></span><span class="fn">next_ch</span>();<br/>
<span class="in6"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_rparen</span>;<br/>
<span class="in5"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'*'</span>) {<br/>
<span class="in6"></span><span class="fn">next_ch</span>();<br/>
<span class="in6"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_times</span>;<br/>
<span class="in5"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'+'</span>) {<br/>
<span class="in6"></span><span class="fn">next_ch</span>();<br/>
<span class="in6"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_plus</span>;<br/>
<span class="in5"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">','</span>) {<br/>
<span class="in6"></span><span class="fn">next_ch</span>();<br/>
<span class="in6"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_comma</span>;<br/>
<span class="in5"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'-'</span>) {<br/>
<span class="in6"></span><span class="fn">next_ch</span>();<br/>
<span class="in6"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_minus</span>;<br/>
<span class="in5"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'.'</span>) {<br/>
<span class="in6"></span><span class="fn">next_ch</span>();<br/>
<span class="in6"></span><span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'.'</span>) {<br/>
<span class="in7"></span><span class="fn">next_ch</span>();<br/>
<span class="in7"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_upto</span>;<br/>
<span class="in6"></span>} <span class="keyword">else</span> {<br/>
<span class="in7"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_period</span>;<br/>
<span class="in6"></span>}<br/>
<span class="in5"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'/'</span>) {<br/>
<span class="in6"></span><span class="fn">next_ch</span>();<br/>
<span class="in6"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_rdiv</span>;<br/>
<span class="in5"></span>}<br/>
<span class="in4"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> &lt; <span class="str">':'</span>) {<br/>
<span class="in5"></span><span class="var">s</span> = <span class="fn">number</span>();<br/>
<span class="in4"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">':'</span>) {<br/>
<span class="in5"></span><span class="fn">next_ch</span>();<br/>
<span class="in5"></span><span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'='</span>) {<br/>
<span class="in6"></span><span class="fn">next_ch</span>();<br/>
<span class="in6"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_becomes</span>;<br/>
<span class="in5"></span>} <span class="keyword">else</span> {<br/>
<span class="in6"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_colon</span>;<br/>
<span class="in5"></span>}<br/>
<span class="in4"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">';'</span>) {<br/>
<span class="in5"></span><span class="fn">next_ch</span>();<br/>
<span class="in5"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_semicolon</span>;<br/>
<span class="in4"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'&lt;'</span>) {<br/>
<span class="in5"></span><span class="fn">next_ch</span>();<br/>
<span class="in5"></span><span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'='</span>) {<br/>
<span class="in6"></span><span class="fn">next_ch</span>();<br/>
<span class="in6"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_leq</span>;<br/>
<span class="in5"></span>} <span class="keyword">else</span> {<br/>
<span class="in6"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_lss</span>;<br/>
<span class="in5"></span>}<br/>
<span class="in4"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'='</span>) {<br/>
<span class="in5"></span><span class="fn">next_ch</span>();<br/>
<span class="in5"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_eql</span>;<br/>
<span class="in4"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'&gt;'</span>) {<br/>
<span class="in5"></span><span class="fn">next_ch</span>();<br/>
<span class="in5"></span><span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'='</span>) {<br/>
<span class="in6"></span><span class="fn">next_ch</span>();<br/>
<span class="in6"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_geq</span>;<br/>
<span class="in5"></span>} <span class="keyword">else</span> {<br/>
<span class="in6"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_gtr</span>;<br/>
<span class="in5"></span>}<br/>
<span class="in4"></span>} <br/>
<span class="in3"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> &lt; <span class="str">'['</span>) {<br/>
<span class="in4"></span><span class="var">s</span> = <span class="fn">identifier</span>();<br/>
<span class="in3"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> &lt; <span class="str">'a'</span>) {<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'['</span>) {<br/>
<span class="in5"></span><span class="fn">next_ch</span>();<br/>
<span class="in5"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_lbrak</span>;<br/>
<span class="in4"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">']'</span>) {<br/>
<span class="in5"></span><span class="fn">next_ch</span>();<br/>
<span class="in5"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_rbrak</span>;<br/>
<span class="in4"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'^'</span>) {<br/>
<span class="in5"></span><span class="fn">next_ch</span>();<br/>
<span class="in5"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_arrow</span>;<br/>
<span class="in4"></span>}<br/>
<span class="in3"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> &lt; <span class="str">'{'</span>) {<br/>
<span class="in4"></span><span class="var">s</span> = <span class="fn">identifier</span>();<br/>
<span class="in3"></span>} <span class="keyword">else</span> {<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'{'</span>) {<br/>
<span class="in5"></span><span class="fn">next_ch</span>();<br/>
<span class="in5"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_lbrace</span>;<br/>
<span class="in4"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'}'</span>) {<br/>
<span class="in5"></span><span class="fn">next_ch</span>();<br/>
<span class="in5"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_rbrace</span>;<br/>
<span class="in4"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'|'</span>) {<br/>
<span class="in5"></span><span class="fn">next_ch</span>();<br/>
<span class="in5"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_bar</span>;<br/>
<span class="in4"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'~'</span>) {<br/>
<span class="in5"></span><span class="fn">next_ch</span>();<br/>
<span class="in5"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_not</span>;<br/>
<span class="in4"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'\x7f'</span>) {<br/>
<span class="in5"></span><span class="fn">next_ch</span>();<br/>
<span class="in5"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_upto</span>;<br/>
<span class="in4"></span>}<br/>
<span class="in3"></span>}<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="var">s</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">impl</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">impl</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="type">Scanner</span>::<span class="fn">comment</span>() {<br/>
<span class="in2"></span><span class="macro">@put(<span class="name">comment</span>)</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">impl</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@def(<span class="name">comment</span>)</span><br/>
<span class="in1"></span><span class="fn">next_ch</span>();<br/>
<span class="in1"></span><span class="var">do</span> {<br/>
<span class="in2"></span><span class="keyword">while</span> (<span class="var">_ch</span> != <span class="num">EOF</span> &amp;&amp; <span class="var">_ch</span> != <span class="str">'*'</span>) {<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'('</span>) {<br/>
<span class="in4"></span><span class="fn">next_ch</span>();<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'*'</span>) {<br/>
<span class="in5"></span><span class="fn">comment</span>();<br/>
<span class="in4"></span>}<br/>
<span class="in3"></span>} <span class="keyword">else</span> {<br/>
<span class="in4"></span><span class="fn">next_ch</span>();<br/>
<span class="in3"></span>}<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">while</span> (<span class="var">_ch</span> == <span class="str">'*'</span>) { <span class="fn">next_ch</span>(); }<br/>
<span class="in1"></span>} <span class="keyword">while</span> (<span class="var">_ch</span> != <span class="num">EOF</span> &amp;&amp; <span class="var">_ch</span> != <span class="str">')'</span>);<br/>
<span class="in1"></span><span class="keyword">if</span> (<span class="var">_ch</span> != <span class="num">EOF</span>) {<br/>
<span class="in2"></span><span class="fn">next_ch</span>();<br/>
<span class="in1"></span>} <span class="keyword">else</span> {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="var">cerr</span> &lt;&lt; <span class="str">"unterminated comment\n"</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">comment</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">includes</span>)</span><br/>
<span class="in1"></span><span class="keyword">#include</span> &lt;<span class="var">limits</span>&gt;<br/>
<span class="macro">@end(<span class="name">includes</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">privates</span>)</span><br/>
<span class="in1"></span><span class="type">int</span> <span class="var">_int_value</span>;<br/>
<span class="in1"></span><span class="type">double</span> <span class="var">_real_value</span>;<br/>
<span class="in1"></span><span class="keyword">static</span> <span class="type">double</span> <span class="fn">ten</span>(<span class="type">int</span> <span class="var">expo</span>);<br/>
<span class="macro">@end(<span class="name">privates</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">includes</span>)</span><br/>
<span class="in1"></span><span class="keyword">#include</span> &lt;<span class="type">vector</span>&gt;<br/>
<span class="macro">@end(<span class="name">includes</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">impl</span>)</span><br/>
<span class="in1"></span><span class="type">double</span> <span class="type">Scanner</span>::<span class="fn">ten</span>(<span class="type">int</span> <span class="var">expo</span>) {<br/>
<span class="in2"></span><span class="type">double</span> <span class="var">x</span> { <span class="num">1</span>.<span class="num">0</span> };<br/>
<span class="in2"></span><span class="type">double</span> <span class="var">t</span> { <span class="num">10</span>.<span class="num">0</span> };<br/>
<span class="in2"></span><span class="keyword">while</span> (<span class="var">expo</span> &gt; <span class="num">0</span>) {<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">expo</span> &amp; <span class="num">1</span>) { <span class="var">x</span> *= <span class="var">t</span>; }<br/>
<span class="in3"></span><span class="var">t</span> *= <span class="var">t</span>;<br/>
<span class="in3"></span><span class="var">expo</span> /= <span class="num">2</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="var">x</span>;<br/>
<span class="in1"></span>}<br/>
<br/>
<span class="in1"></span><span class="type">Symbol</span> <span class="type">Scanner</span>::<span class="fn">number</span>() {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">vector</span>&lt;<span class="type">char</span>&gt; <span class="var">digits</span>;<br/>
<span class="in2"></span><span class="type">Symbol</span> <span class="var">s</span> { <span class="type">Symbol</span>::<span class="var">s_null</span> };<br/>
<span class="in2"></span><span class="var">do</span> {<br/>
<span class="in3"></span><span class="var">digits</span>.<span class="fn">push_back</span>(<span class="var">_ch</span> - <span class="str">'0'</span>);<br/>
<span class="in3"></span><span class="fn">next_ch</span>();<br/>
<span class="in2"></span>} <span class="keyword">while</span> ((<span class="var">_ch</span> &gt;= <span class="str">'0'</span> &amp;&amp; <span class="var">_ch</span> &lt;= <span class="str">'9'</span>) || (<span class="var">_ch</span> &gt;= <span class="str">'A'</span> &amp;&amp; <span class="var">_ch</span> &lt;= <span class="str">'F'</span>));<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'H'</span> || <span class="var">_ch</span> == <span class="str">'R'</span> || <span class="var">_ch</span> == <span class="str">'X'</span>) {<br/>
<span class="in3"></span><span class="type">int</span> <span class="var">k</span> { <span class="num">0</span> };<br/>
<span class="in3"></span><span class="keyword">for</span> (<span class="type">char</span> <span class="var">h</span> : <span class="var">digits</span>) {<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">h</span> &gt;= <span class="num">10</span>) { <span class="var">h</span> -= <span class="num">7</span>; }<br/>
<span class="in4"></span><span class="var">k</span> = <span class="var">k</span> * <span class="num">16</span> + <span class="var">h</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'X'</span>) {<br/>
<span class="in4"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_char</span>;<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">k</span> &lt; <span class="num">0x100</span>) {<br/>
<span class="in5"></span><span class="var">_int_value</span> = <span class="var">k</span>;<br/>
<span class="in4"></span>} <span class="keyword">else</span> {<br/>
<span class="in5"></span><span class="var">_int_value</span> = <span class="num">0</span>;<br/>
<span class="in5"></span><span class="type">std</span>::<span class="var">cerr</span> &lt;&lt; <span class="str">"illegal value\n"</span>;<br/>
<span class="in4"></span>}<br/>
<span class="in3"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'R'</span>) {<br/>
<span class="in4"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_real</span>;<br/>
<span class="in4"></span><span class="var">_real_value</span> = <span class="var">k</span>;<br/>
<span class="in3"></span>} <span class="keyword">else</span> {<br/>
<span class="in4"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_int</span>;<br/>
<span class="in4"></span><span class="var">_int_value</span> = <span class="var">k</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="fn">next_ch</span>();<br/>
<span class="in2"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'.'</span>) {<br/>
<span class="in3"></span><span class="fn">next_ch</span>();<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'.'</span>) {<br/>
<span class="in4"></span><span class="var">_ch</span> = <span class="str">'\x7f'</span>;<br/>
<span class="in4"></span><span class="type">int</span> <span class="var">k</span> = <span class="num">0</span>;<br/>
<span class="in4"></span><span class="keyword">for</span> (<span class="type">const</span> <span class="type">auto</span> &amp;<span class="var">d</span> : <span class="var">digits</span>) {<br/>
<span class="in5"></span><span class="keyword">if</span> (<span class="var">d</span> &lt; <span class="num">10</span>) {<br/>
<span class="in6"></span><span class="keyword">if</span> (<span class="var">k</span> &lt;= (<span class="type">std</span>::<span class="var">numeric_limits</span>&lt;<span class="type">int</span>&gt;::<span class="fn">max</span>() - <span class="var">d</span>) / <span class="num">10</span>) {<br/>
<span class="in7"></span><span class="var">k</span> = <span class="var">k</span> * <span class="num">10</span> + <span class="var">d</span>;<br/>
<span class="in6"></span>} <span class="keyword">else</span> {<br/>
<span class="in7"></span><span class="type">std</span>::<span class="var">cerr</span> &lt;&lt; <span class="str">"too large\n"</span>;<br/>
<span class="in7"></span><span class="keyword">break</span>;<br/>
<span class="in6"></span>}<br/>
<span class="in5"></span>} <span class="keyword">else</span> {<br/>
<span class="in6"></span><span class="type">std</span>::<span class="var">cerr</span> &lt;&lt; <span class="str">"bad integer\n"</span>;<br/>
<span class="in6"></span><span class="keyword">break</span>;<br/>
<span class="in5"></span>}<br/>
<span class="in4"></span>}<br/>
<span class="in4"></span><span class="var">_int_value</span> = <span class="var">k</span>;<br/>
<span class="in4"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_int</span>;<br/>
<span class="in3"></span>} <span class="keyword">else</span> {<br/>
<span class="in4"></span><span class="type">double</span> <span class="var">x</span> { <span class="num">0</span>.<span class="num">0</span> };<br/>
<span class="in4"></span><span class="type">int</span> <span class="var">expo</span> { <span class="num">0</span> };<br/>
<span class="in4"></span><span class="keyword">for</span> (<span class="type">const</span> <span class="type">auto</span> &amp;<span class="var">d</span> : <span class="var">digits</span>) {<br/>
<span class="in5"></span><span class="var">x</span> = <span class="var">x</span> * <span class="num">10</span>.<span class="num">0</span> + <span class="var">d</span>;<br/>
<span class="in4"></span>}<br/>
<span class="in4"></span><span class="keyword">while</span> (<span class="var">_ch</span> &gt;= <span class="str">'0'</span> &amp;&amp; <span class="var">_ch</span> &lt;= <span class="str">'9'</span>) {<br/>
<span class="in5"></span><span class="var">x</span> = <span class="var">x</span> * <span class="num">10</span>.<span class="num">0</span> + (<span class="var">_ch</span> - <span class="str">'0'</span>);<br/>
<span class="in5"></span>++<span class="var">expo</span>;<br/>
<span class="in5"></span><span class="fn">next_ch</span>();<br/>
<span class="in4"></span>}<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'E'</span> || <span class="var">_ch</span> == <span class="str">'D'</span>) {<br/>
<span class="in5"></span><span class="fn">next_ch</span>();<br/>
<span class="in5"></span><span class="type">bool</span> <span class="var">neg_expo</span> { <span class="num">false</span> };<br/>
<span class="in5"></span><span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'-'</span>) {<br/>
<span class="in6"></span><span class="fn">next_ch</span>();<br/>
<span class="in6"></span><span class="var">neg_expo</span> = <span class="num">true</span>;<br/>
<span class="in5"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> == <span class="str">'+'</span>) {<br/>
<span class="in6"></span><span class="fn">next_ch</span>();<br/>
<span class="in5"></span>}<br/>
<span class="in5"></span><span class="keyword">if</span> (<span class="var">_ch</span> &gt;= <span class="str">'0'</span> &amp;&amp; <span class="var">_ch</span> &lt;= <span class="str">'9'</span>) {<br/>
<span class="in6"></span><span class="type">int</span> <span class="var">scale</span> { <span class="num">0</span> };<br/>
<span class="in6"></span><span class="keyword">while</span> (<span class="var">_ch</span> &gt;= <span class="num">0</span> &amp;&amp; <span class="var">_ch</span> &lt;= <span class="str">'9'</span>) {<br/>
<span class="in7"></span><span class="var">scale</span> = <span class="var">scale</span> * <span class="num">10</span> + (<span class="var">_ch</span> - <span class="str">'0'</span>);<br/>
<span class="in7"></span><span class="fn">next_ch</span>();<br/>
<span class="in6"></span>}<br/>
<span class="in6"></span><span class="keyword">if</span> (<span class="var">neg_expo</span>) {<br/>
<span class="in7"></span><span class="var">expo</span> -= <span class="var">scale</span>;<br/>
<span class="in6"></span>} <span class="keyword">else</span> {<br/>
<span class="in7"></span><span class="var">expo</span> += <span class="var">scale</span>;<br/>
<span class="in6"></span>}<br/>
<br/>
<span class="in5"></span>} <span class="keyword">else</span> {<br/>
<span class="in6"></span><span class="type">std</span>::<span class="var">cerr</span> &lt;&lt; <span class="str">"digit?\n"</span>;<br/>
<span class="in5"></span>}<br/>
<span class="in4"></span>}<br/>
<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">expo</span> &lt; <span class="num">0</span>) {<br/>
<span class="in5"></span><span class="keyword">if</span> (<span class="var">expo</span> &gt;= <span class="type">std</span>::<span class="var">numeric_limits</span>&lt;<span class="type">double</span>&gt;::<span class="var">min_exponent10</span>) {<br/>
<span class="in6"></span><span class="var">x</span> = <span class="var">x</span> / <span class="fn">ten</span>(-<span class="var">expo</span>);<br/>
<span class="in5"></span>} <span class="keyword">else</span> {<br/>
<span class="in6"></span><span class="var">x</span> = <span class="num">0</span>.<span class="num">0</span>;<br/>
<span class="in5"></span>}<br/>
<span class="in4"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">expo</span> &gt; <span class="num">0</span>) {<br/>
<span class="in5"></span><span class="keyword">if</span> (<span class="var">expo</span> &lt;= <span class="type">std</span>::<span class="var">numeric_limits</span>&lt;<span class="type">double</span>&gt;::<span class="var">max_exponent10</span>) {<br/>
<span class="in6"></span><span class="var">x</span> = <span class="var">x</span> * <span class="fn">ten</span>(<span class="var">expo</span>);<br/>
<span class="in5"></span>} <span class="keyword">else</span> {<br/>
<span class="in6"></span><span class="var">x</span> = <span class="num">0</span>.<span class="num">0</span>;<br/>
<span class="in6"></span><span class="type">std</span>::<span class="var">cerr</span> &lt;&lt; <span class="str">"too large\n"</span>;<br/>
<span class="in5"></span>}<br/>
<span class="in4"></span>}<br/>
<br/>
<span class="in4"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_real</span>;<br/>
<span class="in4"></span><span class="var">_real_value</span> = <span class="var">x</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in2"></span>} <span class="keyword">else</span> {<br/>
<span class="in3"></span><span class="type">int</span> <span class="var">k</span> = <span class="num">0</span>;<br/>
<span class="in3"></span><span class="keyword">for</span> (<span class="type">const</span> <span class="type">auto</span> &amp;<span class="var">d</span>: <span class="var">digits</span>) {<br/>
<span class="in4"></span><span class="keyword">if</span> (<span class="var">d</span> &lt; <span class="num">10</span>) {<br/>
<span class="in5"></span><span class="keyword">if</span> (<span class="var">k</span> &lt;= (<span class="type">std</span>::<span class="var">numeric_limits</span>&lt;<span class="type">int</span>&gt;::<span class="fn">max</span>() - <span class="var">d</span>) / <span class="num">10</span>) {<br/>
<span class="in6"></span><span class="var">k</span> = <span class="var">k</span> * <span class="num">10</span> + <span class="var">d</span>;<br/>
<span class="in5"></span>} <span class="keyword">else</span> {<br/>
<span class="in6"></span><span class="type">std</span>::<span class="var">cerr</span> &lt;&lt; <span class="str">"too large\n"</span>;<br/>
<span class="in6"></span><span class="keyword">break</span>;<br/>
<span class="in5"></span>}<br/>
<span class="in4"></span>} <span class="keyword">else</span> {<br/>
<span class="in5"></span><span class="type">std</span>::<span class="var">cerr</span> &lt;&lt; <span class="str">"bad integer\n"</span>;<br/>
<span class="in5"></span><span class="keyword">break</span>;<br/>
<span class="in4"></span>}<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="var">_int_value</span> = <span class="var">k</span>;<br/>
<span class="in3"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_int</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="var">s</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">impl</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">privates</span>)</span><br/>
<span class="in1"></span><span class="type">Symbol</span> <span class="fn">identifier</span>();<br/>
<span class="in1"></span><span class="type">std</span>::<span class="type">string</span> <span class="var">_id</span>;<br/>
<span class="macro">@end(<span class="name">privates</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">impl</span>)</span><br/>
<span class="in1"></span><span class="type">Symbol</span> <span class="type">Scanner</span>::<span class="fn">identifier</span>() {<br/>
<span class="in2"></span><span class="type">Symbol</span> <span class="var">s</span> { <span class="type">Symbol</span>::<span class="var">s_null</span> };<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">string</span> <span class="var">id</span>;<br/>
<span class="in2"></span><span class="var">do</span> {<br/>
<span class="in3"></span><span class="var">id</span> += (<span class="type">char</span>) <span class="var">_ch</span>;<br/>
<span class="in3"></span><span class="fn">next_ch</span>();<br/>
<span class="in2"></span>} <span class="keyword">while</span> ((<span class="var">_ch</span> &gt;= <span class="str">'0'</span> &amp;&amp; <span class="var">_ch</span> &lt;= <span class="str">'9'</span>) || (<span class="var">_ch</span> &gt;= <span class="str">'A'</span> &amp;&amp; <span class="var">_ch</span> &lt;= <span class="str">'Z'</span>) || (<span class="var">_ch</span> &gt;= <span class="str">'a'</span> &amp;&amp; <span class="var">_ch</span> &lt;= <span class="str">'z'</span>));<br/>
<span class="in2"></span><span class="type">auto</span> <span class="var">found</span> = <span class="var">keywords</span>.<span class="fn">find</span>(<span class="var">id</span>);<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">found</span> != <span class="var">keywords</span>.<span class="fn">end</span>()) {<br/>
<span class="in3"></span><span class="var">s</span> = <span class="var">found</span>-&gt;<span class="var">second</span>;<br/>
<span class="in2"></span>} <span class="keyword">else</span> {<br/>
<span class="in3"></span><span class="var">s</span> = <span class="type">Symbol</span>::<span class="var">s_ident</span>;<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="var">_id</span> = <span class="var">id</span>;<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="var">s</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">impl</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">privates</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">string</span>();<br/>
<span class="in1"></span><span class="type">std</span>::<span class="type">string</span> <span class="var">_string</span>;<br/>
<span class="macro">@end(<span class="name">privates</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">impl</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="type">Scanner</span>::<span class="fn">string</span>() {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">string</span> <span class="var">str</span>;<br/>
<span class="in2"></span><span class="fn">next_ch</span>();<br/>
<span class="in2"></span><span class="keyword">while</span> (<span class="var">_ch</span> != <span class="num">EOF</span> &amp;&amp; <span class="var">_ch</span> != <span class="str">'"'</span>) {<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">_ch</span> &gt;= <span class="str">' '</span>) {<br/>
<span class="in4"></span><span class="var">str</span> += (<span class="type">char</span>) <span class="var">_ch</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="fn">next_ch</span>();<br/>
<span class="in2"></span>}<br/>
<span class="in2"></span><span class="keyword">if</span> (<span class="var">_ch</span> != <span class="num">EOF</span>) { <span class="fn">next_ch</span>(); }<br/>
<span class="in2"></span><span class="var">_string</span> = <span class="var">str</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">impl</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">privates</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="fn">hex_string</span>();<br/>
<span class="macro">@end(<span class="name">privates</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">impl</span>)</span><br/>
<span class="in1"></span><span class="type">void</span> <span class="type">Scanner</span>::<span class="fn">hex_string</span>() {<br/>
<span class="in2"></span><span class="type">std</span>::<span class="type">string</span> <span class="var">str</span>;<br/>
<span class="in2"></span><span class="fn">next_ch</span>();<br/>
<span class="in2"></span><span class="type">int</span> <span class="var">m</span>, <span class="var">n</span>;<br/>
<span class="in2"></span><span class="keyword">while</span> (<span class="var">_ch</span> != <span class="num">EOF</span> &amp;&amp; <span class="var">_ch</span> != <span class="str">'$'</span>) {<br/>
<span class="in3"></span><span class="keyword">while</span> (<span class="var">_ch</span> != <span class="num">EOF</span> &amp;&amp; <span class="var">_ch</span> &lt;= <span class="str">' '</span>) {<br/>
<span class="in4"></span><span class="fn">next_ch</span>();<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">_ch</span> &gt;= <span class="str">'0'</span> &amp;&amp; <span class="var">_ch</span> &lt;= <span class="str">'9'</span>) {<br/>
<span class="in4"></span><span class="var">m</span> = <span class="var">_ch</span> - <span class="str">'0'</span>;<br/>
<span class="in3"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> &gt;= <span class="str">'A'</span> &amp;&amp; <span class="var">_ch</span> &lt;= <span class="str">'F'</span>) {<br/>
<span class="in4"></span><span class="var">m</span> = <span class="var">_ch</span> - <span class="str">'A'</span> + <span class="num">10</span>;<br/>
<span class="in3"></span>} <span class="keyword">else</span> {<br/>
<span class="in4"></span><span class="type">std</span>::<span class="var">cerr</span> &lt;&lt; <span class="str">"hexdig expected\n"</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="fn">next_ch</span>();<br/>
<span class="in3"></span><span class="keyword">if</span> (<span class="var">_ch</span> &gt;= <span class="str">'0'</span> &amp;&amp; <span class="var">_ch</span> &lt;= <span class="str">'9'</span>) {<br/>
<span class="in4"></span><span class="var">n</span> = <span class="var">_ch</span> - <span class="str">'0'</span>;<br/>
<span class="in3"></span>} <span class="keyword">else</span> <span class="keyword">if</span> (<span class="var">_ch</span> &gt;= <span class="str">'A'</span> &amp;&amp; <span class="var">_ch</span> &lt;= <span class="str">'F'</span>) {<br/>
<span class="in4"></span><span class="var">n</span> = <span class="var">_ch</span> - <span class="str">'A'</span> + <span class="num">10</span>;<br/>
<span class="in3"></span>} <span class="keyword">else</span> {<br/>
<span class="in4"></span><span class="type">std</span>::<span class="var">cerr</span> &lt;&lt; <span class="str">"hexdig expected\n"</span>;<br/>
<span class="in3"></span>}<br/>
<span class="in3"></span><span class="var">str</span> += (<span class="type">char</span>) (<span class="var">m</span> * <span class="num">16</span> + <span class="var">n</span>);<br/>
<span class="in3"></span><span class="fn">next_ch</span>();<br/>
<span class="in2"></span>}<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">impl</span>)</span><br/>
</code></div>
</div>
<div><div>
<code>
<span class="macro">@add(<span class="name">publics</span>)</span><br/>
<span class="in1"></span><span class="type">const</span> <span class="type">std</span>::<span class="type">string</span> &amp;<span class="fn">id</span>() <span class="type">const</span> {<br/>
<span class="in2"></span><span class="keyword">return</span> <span class="var">_id</span>;<br/>
<span class="in1"></span>}<br/>
<span class="macro">@end(<span class="name">publics</span>)</span><br/>
</code></div>
</div>
</body>
</html>
